<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Separate Squares – Drag Demo</title>

<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
<script src="https://unpkg.com/gsap@3/dist/Draggable.min.js"></script>

<style>
body {
  margin: 0;
  background: #020617;
  font-family: Inter, sans-serif;
  color: white;
}

h2 {
  text-align: center;
  margin: 12px 0;
}

.wrapper {
  display: flex;
  justify-content: center;
  padding: 10px;
}

.board {
  position: relative;
  width: 100%;
  max-width: 420px;
  height: 420px;
  background: #0f172a;
  border-radius: 12px;
  overflow: hidden;
}

.square {
  position: absolute;
  background: rgba(59,130,246,0.6);
  border: 1px solid #3b82f6;
}

.line {
  position: absolute;
  width: 100%;
  height: 3px;
  background: #facc15;
  cursor: grab;
}

.info {
  max-width: 420px;
  margin: 12px auto;
  background: #020617;
  padding: 12px;
  border-radius: 8px;
  font-size: 14px;
}

.equal {
  color: #22c55e;
  font-weight: bold;
}

@media (max-width: 480px) {
  .board {
    height: 300px;
  }
}
</style>
</head>

<body>

<h2>Drag the Line to Balance Area</h2>

<div class="wrapper">
  <div class="board" id="board">
    <div class="line" id="line"></div>
  </div>
</div>

<div class="info" id="info"></div>

<script>
/* ============================
   DATA (Squares)
============================ */
const squares = [
  { x: 40, y: 40, l: 140 },
  { x: 120, y: 120, l: 120 },
  { x: 220, y: 60, l: 80 }
];

const board = document.getElementById("board");
const H = board.clientHeight;

/* ============================
   RENDER SQUARES
============================ */
squares.forEach(s => {
  const el = document.createElement("div");
  el.className = "square";
  el.style.left = s.x + "px";
  el.style.bottom = s.y + "px";
  el.style.width = s.l + "px";
  el.style.height = s.l + "px";
  board.appendChild(el);
});

/* ============================
   UNION AREA BELOW Y
============================ */
function areaBelowY(yLine) {
  const events = [];

  squares.forEach(s => {
    const y0 = s.y;
    const y1 = s.y + s.l;
    if (yLine <= y0) return;
    const height = Math.min(yLine, y1) - y0;
    if (height > 0) {
      events.push([s.x, s.x + s.l]);
    }
  });

  if (!events.length) return 0;

  events.sort((a, b) => a[0] - b[0]);

  let union = 0;
  let [start, end] = events[0];

  for (let i = 1; i < events.length; i++) {
    const [s, e] = events[i];
    if (s > end) {
      union += end - start;
      start = s;
      end = e;
    } else {
      end = Math.max(end, e);
    }
  }
  union += end - start;

  let area = 0;
  squares.forEach(s => {
    const bottom = s.y;
    const top = s.y + s.l;
    if (yLine > bottom) {
      const h = Math.min(yLine, top) - bottom;
      if (h > 0) area += h * s.l;
    }
  });

  return union * 1; // logical union width × 1 unit height slice
}

/* ============================
   TOTAL UNION AREA
============================ */
function totalUnionArea() {
  let minY = Infinity, maxY = -Infinity;
  squares.forEach(s => {
    minY = Math.min(minY, s.y);
    maxY = Math.max(maxY, s.y + s.l);
  });

  let area = 0;
  for (let y = minY; y < maxY; y += 1) {
    area += areaBelowY(y + 1) - areaBelowY(y);
  }
  return area;
}

const TOTAL = totalUnionArea();

/* ============================
   UPDATE UI
============================ */
function updateInfo(y) {
  const below = areaBelowY(y);
  const above = TOTAL - below;
  const diff = Math.abs(above - below);

  document.getElementById("info").innerHTML = `
    ⬆ Above Area: ${above.toFixed(2)} <br/>
    ⬇ Below Area: ${below.toFixed(2)} <br/>
    ${diff < 5 ? '<span class="equal">✔ Balanced</span>' : ''}
  `;
}

/* ============================
   DRAGGABLE LINE
============================ */
const line = document.getElementById("line");

gsap.set(line, { top: H / 2 });

Draggable.create(line, {
  type: "y",
  bounds: board,
  inertia: true,
  onDrag() {
    const y = H - this.y;
    updateInfo(y);
  },
  onThrowUpdate() {
    const y = H - this.y;
    updateInfo(y);
  }
});

/* Initial */
updateInfo(H / 2);
</script>

</body>
</html>
